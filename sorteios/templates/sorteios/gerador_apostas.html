{% extends 'sorteios/base.html' %}

{% block title %}Gerador de Apostas - EuroMilhões Analyzer{% endblock %}

{% block content %}
<h1 class="mb-4"><i class="bi bi-dice-5 me-2"></i>Gerador de Apostas</h1>

<div class="row">
    <div class="col-lg-5">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Configurações</h5>
            </div>
            <div class="card-body">
                <!-- Tabs para tipo de aposta -->
                <ul class="nav nav-pills mb-4" id="tipoApostaTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="simples-tab" data-bs-toggle="pill"
                                data-bs-target="#simples" type="button" role="tab">
                            <i class="bi bi-1-circle me-1"></i>Aposta Simples
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="multipla-tab" data-bs-toggle="pill"
                                data-bs-target="#multipla" type="button" role="tab">
                            <i class="bi bi-grid-3x3 me-1"></i>Aposta Múltipla
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="tipoApostaTabContent">
                    <!-- Tab Aposta Simples -->
                    <div class="tab-pane fade show active" id="simples" role="tabpanel">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="tipo_aposta" value="simples">

                            <div class="mb-3">
                                <label class="form-label">Estratégia</label>
                                {% for value, label in estrategias %}
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="estrategia"
                                           id="estrategia_simples_{{ value }}" value="{{ value }}"
                                           {% if value == 'equilibrada' %}checked{% endif %}>
                                    <label class="form-check-label" for="estrategia_simples_{{ value }}">
                                        {{ label }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="mb-3">
                                <label for="quantidade" class="form-label">Quantidade de Apostas</label>
                                <select class="form-select" name="quantidade" id="quantidade">
                                    {% for i in "12345" %}
                                    <option value="{{ i }}" {% if i == "1" %}selected{% endif %}>{{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-lightning me-2"></i>Gerar Apostas Simples
                            </button>
                        </form>
                    </div>

                    <!-- Tab Aposta Múltipla -->
                    <div class="tab-pane fade" id="multipla" role="tabpanel">
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="tipo_aposta" value="multipla">

                            <div class="mb-3">
                                <label class="form-label">Estratégia</label>
                                {% for value, label in estrategias %}
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="estrategia"
                                           id="estrategia_multipla_{{ value }}" value="{{ value }}"
                                           {% if value == 'equilibrada' %}checked{% endif %}>
                                    <label class="form-check-label" for="estrategia_multipla_{{ value }}">
                                        {{ label }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="n_numeros" class="form-label">
                                        <i class="bi bi-circle-fill text-primary me-1"></i>Números (5-10)
                                    </label>
                                    <select class="form-select" name="n_numeros" id="n_numeros" onchange="atualizarCusto()">
                                        <option value="5">5 números</option>
                                        <option value="6" selected>6 números</option>
                                        <option value="7">7 números</option>
                                        <option value="8">8 números</option>
                                        <option value="9">9 números</option>
                                        <option value="10">10 números</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label for="n_estrelas" class="form-label">
                                        <i class="bi bi-star-fill text-warning me-1"></i>Estrelas (2-5)
                                    </label>
                                    <select class="form-select" name="n_estrelas" id="n_estrelas" onchange="atualizarCusto()">
                                        <option value="2">2 estrelas</option>
                                        <option value="3" selected>3 estrelas</option>
                                        <option value="4">4 estrelas</option>
                                        <option value="5">5 estrelas</option>
                                    </select>
                                </div>
                            </div>

                            <div class="alert alert-info mb-3" id="custoInfo">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Combinações:</strong> <span id="numCombinacoes">6</span>
                                    </div>
                                    <div>
                                        <strong>Custo:</strong> <span id="custoTotal">15.00</span>€
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success w-100">
                                <i class="bi bi-grid-3x3 me-2"></i>Gerar Aposta Múltipla
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabela de Combinações -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-table me-2"></i>Tabela de Combinações</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Números</th>
                                <th>Estrelas</th>
                                <th>Combinações</th>
                                <th>Custo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>5</td><td>2</td><td>1</td><td>2.50€</td></tr>
                            <tr><td>6</td><td>2</td><td>6</td><td>15.00€</td></tr>
                            <tr><td>6</td><td>3</td><td>18</td><td>45.00€</td></tr>
                            <tr><td>7</td><td>2</td><td>21</td><td>52.50€</td></tr>
                            <tr><td>7</td><td>3</td><td>63</td><td>157.50€</td></tr>
                            <tr><td>8</td><td>2</td><td>56</td><td>140.00€</td></tr>
                            <tr><td>8</td><td>3</td><td>168</td><td>420.00€</td></tr>
                            <tr><td>9</td><td>2</td><td>126</td><td>315.00€</td></tr>
                            <tr><td>10</td><td>2</td><td>252</td><td>630.00€</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Sobre as Estratégias</h5>
            </div>
            <div class="card-body">
                <dl>
                    <dt>Baseada em Frequência</dt>
                    <dd class="text-muted small">Favorece números que saem mais vezes.</dd>

                    <dt>Distribuição Equilibrada</dt>
                    <dd class="text-muted small">Equilibra pares/ímpares e baixos/altos.</dd>

                    <dt>Aleatório Puro</dt>
                    <dd class="text-muted small">Seleção completamente aleatória.</dd>

                    <dt>Números Frios</dt>
                    <dd class="text-muted small">Favorece números que saem menos.</dd>

                    <dt>Estratégia Mista</dt>
                    <dd class="text-muted small">Combina quentes, frios e atrasados.</dd>
                </dl>

                <div class="alert alert-warning mb-0">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <small>
                        <strong>Lembrete:</strong> Cada sorteio é independente.
                        Estas estratégias são apenas para análise e entretenimento.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-7">
        <!-- Apostas Simples -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-list-check me-2"></i>Apostas Simples Geradas</h5>
            </div>
            <div class="card-body">
                {% if apostas_recentes %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Números</th>
                                <th>Estrelas</th>
                                <th>Estratégia</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for aposta in apostas_recentes %}
                            <tr>
                                <td>
                                    <small>{{ aposta.data_geracao|date:"d/m/Y H:i" }}</small>
                                </td>
                                <td>
                                    {% for num in aposta.get_numeros %}
                                        <span class="numero-ball small">{{ num|stringformat:"02d" }}</span>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for est in aposta.get_estrelas %}
                                        <span class="estrela-ball small">{{ est|stringformat:"02d" }}</span>
                                    {% endfor %}
                                </td>
                                <td>
                                    <span class="badge bg-secondary">{{ aposta.get_estrategia_display }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center text-muted py-4">
                    <i class="bi bi-inbox fs-1"></i>
                    <p class="mt-2">Nenhuma aposta simples gerada ainda.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Apostas Múltiplas -->
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-grid-3x3 me-2"></i>Apostas Múltiplas Geradas</h5>
            </div>
            <div class="card-body">
                {% if apostas_multiplas_recentes %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Números</th>
                                <th>Estrelas</th>
                                <th>Combinações</th>
                                <th>Custo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for aposta in apostas_multiplas_recentes %}
                            <tr>
                                <td>
                                    <small>{{ aposta.data_geracao|date:"d/m/Y H:i" }}</small>
                                </td>
                                <td>
                                    {% for num in aposta.get_numeros %}
                                        <span class="numero-ball small">{{ num|stringformat:"02d" }}</span>
                                    {% endfor %}
                                </td>
                                <td>
                                    {% for est in aposta.get_estrelas %}
                                        <span class="estrela-ball small">{{ est|stringformat:"02d" }}</span>
                                    {% endfor %}
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ aposta.total_combinacoes }}</span>
                                </td>
                                <td>
                                    <strong>{{ aposta.custo_total }}€</strong>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center text-muted py-4">
                    <i class="bi bi-grid-3x3 fs-1"></i>
                    <p class="mt-2">Nenhuma aposta múltipla gerada ainda.</p>
                    <p><small>Use a tab "Aposta Múltipla" para gerar!</small></p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Tabela de combinações pré-calculada
const combinacoes = {
    '5-2': {comb: 1, custo: 2.50},
    '5-3': {comb: 3, custo: 7.50},
    '5-4': {comb: 6, custo: 15.00},
    '5-5': {comb: 10, custo: 25.00},
    '6-2': {comb: 6, custo: 15.00},
    '6-3': {comb: 18, custo: 45.00},
    '6-4': {comb: 36, custo: 90.00},
    '6-5': {comb: 60, custo: 150.00},
    '7-2': {comb: 21, custo: 52.50},
    '7-3': {comb: 63, custo: 157.50},
    '7-4': {comb: 126, custo: 315.00},
    '7-5': {comb: 210, custo: 525.00},
    '8-2': {comb: 56, custo: 140.00},
    '8-3': {comb: 168, custo: 420.00},
    '8-4': {comb: 336, custo: 840.00},
    '8-5': {comb: 560, custo: 1400.00},
    '9-2': {comb: 126, custo: 315.00},
    '9-3': {comb: 378, custo: 945.00},
    '9-4': {comb: 756, custo: 1890.00},
    '9-5': {comb: 1260, custo: 3150.00},
    '10-2': {comb: 252, custo: 630.00},
    '10-3': {comb: 756, custo: 1890.00},
    '10-4': {comb: 1512, custo: 3780.00},
    '10-5': {comb: 2520, custo: 6300.00}
};

function atualizarCusto() {
    const nNumeros = document.getElementById('n_numeros').value;
    const nEstrelas = document.getElementById('n_estrelas').value;
    const key = nNumeros + '-' + nEstrelas;

    if (combinacoes[key]) {
        document.getElementById('numCombinacoes').textContent = combinacoes[key].comb;
        document.getElementById('custoTotal').textContent = combinacoes[key].custo.toFixed(2);
    }
}

// Atualizar ao carregar
document.addEventListener('DOMContentLoaded', atualizarCusto);
</script>
{% endblock %}
